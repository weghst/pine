<?xml version="1.0" encoding="UTF-8"?>
<!--

    Copyright (C) 2015 The Weghst Inc. (kevinz@weghst.com)

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

            http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

    <changeSet id="1439026570" author="kevinz@weghst.com">
        <createTable tableName="t_config">
            <column name="key" type="varchar(50)" remarks="配置属性键, 全局唯一">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="value" type="varchar(258)" remarks="配置属性值"/>
            <column name="description" type="varchar(512)" remarks="属性描述"/>
            <column name="comments" type="varchar(512)" remarks="额外的备注信息"/>
            <column name="lastUpdatedTime" type="bigint" remarks="属性最后修改时间"/>
        </createTable>

        <createProcedure>
            create trigger tri_config_insert before insert on t_config
            for each row
            begin
                if (new.lastUpdatedTime is null)
                then
                    set new.lastUpdatedTime = unix_timestamp();
                end if;
            end
        </createProcedure>
        <rollback>
            drop trigger tri_config_insert
        </rollback>

        <loadData tableName="t_config" file="db/t_config-1.0.csv"/>
    </changeSet>

    <changeSet id="1439026604" author="kevinz@weghst.com">
        <createTable tableName="t_user">
            <column name="id" type="int" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="email" type="varchar(32)">
                <constraints unique="true"/>
            </column>
            <column name="password" type="varchar(50)"/>
            <column name="createdTime" type="bigint"/>
        </createTable>
    </changeSet>
    
</databaseChangeLog>
